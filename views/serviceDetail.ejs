<%- include partials/innerheader %>


  <style type="text/css">
    .successmsg {
      color: #fff;
      padding-left: 350px;
    }

    .successmsg3 {
      color: #fff;
      padding-left: 45px;
      padding-bottom: 30px;
      font-size: large;
    }

    .edit_profile_form {
      /* position:relative;
left:30%; */
      width: 100%;
    }

    .prfl_tb_cntnt_bx {
      margin: 0;
    }

    .secutityByStripe {
      padding-left: 30px;
      position: absolute;
      left: 100%;
      top: 12px;
    }

    .exp-wrapper {
      position: relative;
      /* border: 1px solid #aaa; */
      display: flex;
      /* width: 300px; */
      justify-content: space-around;
      height: 36px;
      line-height: 36px;
      font-size: 24px;
    }

    .exp-wrapper:after {
      content: "/";
      position: absolute;
      left: 50%;
      margin-left: -4px;
      color: #aaa;
    }

    input.exp {
      float: left;
      font-family: monospace;
      border: 0;
      width: 18px;
      outline: none;
      appearance: none;
      font-size: 14px;
    }

    .input-groups {
      display: flex;
    }

    .input-group #shortDescriptionService {
      width: 65%;
      float: right;
    }
  </style>

  <div class="app_main">
    <%- include partials/innersidebar %>

      <div class="app_content">
        <div class="dsbrd_container">
          <div class="dashboard_wrapper row">
            <div class="dashboard_wrapper_left col" style="max-width: 60%">
              <div class="prfl_tb_cntnt_bx">
                <h2>Service Detail</h2>
                <!-- <p>Thank you for Joining this service</p> -->
              </div>
              <div class="post_new_tips_wrapper">
                <div class="edit_profile_form">
                  <div class="input-group">
                    <label>Type of Service</label>
                    <span style="color: white" id="typeService"></span>
                  </div>

                  <div class="input-group">
                    <label>Name of Service</label>
                    <span style="color: white" id="nameService"></span>
                  </div>
                  <div class="input-group" style="display: inline;">
                    <label>Descritpion</label>
                    <span style="color: white;" id="shortDescriptionService"></span>
                  </div>

                  <div class="input-group">
                    <!--   <label>Long Description</label>
                            <span style="color: white;" id="longDescriptionService"></span> -->

                  </div>
                  <div class="input-group">
                    <label>Mentor Name</label>
                    <span style="color: white" id="mentorNameService"></span>
                  </div>
                  <div class="input-group">
                    <label>Frequency</label>
                    <span style="color: white" id="frequncyService"></span>
                  </div>
                  <div class="input-group">
                    <label>Price</label>
                    <span style="color: white" id="priceService"></span>
                  </div>
                </div>
              </div>
            </div>
            <div class="dashboard_wrapper_right col" style="max-width: 40%; padding-top: 55px">
              <div class="input-group">
                <img id="serviceImage" class="img-responsive" style="max-width:100%" />
              </div>
            </div>
          </div>
          <br />

          <div class="edit_profile_form">
            <p style="color: white; text-align: center">
              Great ! <br />Thank you, rahul
            </p>
            <h5 class="text-center">Please complete your purchase below</h5>
          </div>

          <br />

          <div class="dsbrd_container" style="margin-left: 15px">
            <div class="dashboard_wrapper row">
              <form action="payment" method="POST" class="flex flex-col" style="width: 60%; position: relative"
                onSubmit="handleFormSubmit(this); return false;">
                <div class="post_new_tips_wrapper">
                  <div class="edit_profile_form">
                    <div class="input-group">
                      <!-- <label>Card Number</label> -->

                      <input type="text" name="userName" value="<%= userName %>" style="display: none" />
                      <input type="text" name="userId" value="<%= userid %>" style="display: none" />
                      <input type="text" name="emailData" value="<%= email %>" style="display: none" />
                      <input type="text" name="tokendata" value="<%= tokens %>" style="display: none" />
                      <input type="text" name="amount" id="prices" style="display: none" />
                      <input type="text" name="serviceIds" value="<%= tipsIds %>" style="display: none" />

                      <input type="text" class="form-control" name="cardName" id="cardName" placeholder=" Full Name"
                        required="required" />
                      <!-- <span id="error" style="color: Red; display: none">* Input digits (0 - 9)</span>   -->
                    </div>
                    <div class="input-group">
                      <!-- <label>Card Number</label> -->
                      <input type="text" class="form-control" name="cardNumber" id="cardNumber"
                        placeholder="Card Number" onkeypress="return IsNumeric(event);" ondrop="return false;"
                        onpaste="return false;" required="required" />
                      <span id="error" style="color: Red; display: none">* Input digits (0 - 9)</span>
                    </div>
                    <div class="input-groups">
                      <div class="input-group">
                        <!-- example 1  start-->
                        <input maxlength="5" class="form-control" placeholder="Ex. Date  MM/YY" type="text"
                          onkeyup="formatString(event);" name="monthYear" style="margin-right: 10px" />
                        <!-- end -->
                      </div>

                      <div class="input-group">
                        <!--  <label>Cvv Number</label> -->
                        <input type="text" class="form-control" name="cvv" id="cvv" placeholder="CVV"
                          required="required" maxlength="3" onkeypress="return IsNumerics(event);"
                          ondrop="return false;" onpaste="return false;" />
                        <span id="errors" style="color: Red; display: none">* Input digits (0 - 9)</span>
                      </div>
                    </div>
                    <div class="input-group">
                      <!-- <label>Zip Code</label> -->
                      <input type="text" class="form-control" placeholder="Zip Code" required="required" maxlength="5"
                        onkeypress="return IsNumericpincode(event);" ondrop="return false;" onpaste="return false;"
                        style="max-width: 50%" />
                      <span id="errorpincode" style="color: Red; display: none">* Input digits (0 - 9)</span>
                    </div>

                    <spam style="color: #a3a3a3b8; margin-left: 15px">Have a Promo Code ?</spam>
                    <div class="input-group">
                      <input type="text" class="form-control" name="text1" id="couponadd" placeholder="Enter Promo Code"
                        style="margin-right: 10px" />
                      <!-- <span id="errorpincode" style="color: Red; display: none">* Input digits (0 - 9)</span> -->
                      <button class="btn cmn_btn btn_primary" type="button" id="stockadd"
                        onclick="validate(document.getElementsByName('text1')[0].value)">
                        Apply
                      </button>
                    </div>
                    <!-- <div class="app_header_content">
                              <div class="dsbrd_container"> -->
                    <div class="successmsg3"></div>
                    <!-- <span style="color: white;" id="priceService">&macr;</span> -->

                    <!-- </div>
                            </div> -->

                    <div class="input-groups">
                      <label class="hide-sm" style="
                          width: 40%;
                          padding-left: 15px;
                          font-size: large;
                          color: #aaa;
                        ">Total
                        <!-- <label class="hide-sm">Total</label> -->
                        <span style="color: white" id="priceServices"></span>
                      </label>
                      <div class="input-group">
                        <label class="hide-sm" style="width: 15%">
                          &nbsp;
                        </label>
                        <button class="btn cmn_btn btn_primary" type="submit">
                          Purchase
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <br />
                <br />
              </form>
            </div>
          </div>

        </div>
      </div>

      <%- include partials/innerfooter %>


        <script>
          function cc_format(value) {
            var v = value.replace(/\s+/g, "").replace(/[^0-9]/gi, "");
            var matches = v.match(/\d{4,16}/g);
            var match = (matches && matches[0]) || "";
            var parts = [];
            for (i = 0, len = match.length; i < len; i += 4) {
              parts.push(match.substring(i, i + 4));
            }
            if (parts.length) {
              return parts.join(" ");
            } else {
              return value;
            }
          }

          onload = function () {
            document.getElementById("cardNumber").oninput = function () {
              this.value = cc_format(this.value);
            };
          };

          var specialKeys = new Array();
          specialKeys.push(8);
          function IsNumeric(e) {
            var keyCode = e.which ? e.which : e.keyCode;
            var ret =
              (keyCode >= 48 && keyCode <= 57) || specialKeys.indexOf(keyCode) != -1;
            document.getElementById("error").style.display = ret ? "none" : "inline";
            return ret;
          }
          function IsNumerics(e) {
            var keyCode = e.which ? e.which : e.keyCode;
            var ret =
              (keyCode >= 48 && keyCode <= 57) || specialKeys.indexOf(keyCode) != -1;
            document.getElementById("errors").style.display = ret ? "none" : "inline";
            return ret;
          }
          function IsNumericpincode(e) {
            var keyCode = e.which ? e.which : e.keyCode;
            var ret =
              (keyCode >= 48 && keyCode <= 57) || specialKeys.indexOf(keyCode) != -1;
            document.getElementById("errorpincode").style.display = ret
              ? "none"
              : "inline";
            return ret;
          }
        </script>

        <script>
          function formatString(e) {
            var inputChar = String.fromCharCode(event.keyCode);
            var code = event.keyCode;
            var allowedKeys = [8];
            if (allowedKeys.indexOf(code) !== -1) {
              return;
            }

            event.target.value = event.target.value
              .replace(
                /^([1-9]\/|[2-9])$/g,
                "0$1/" // 3 > 03/
              )
              .replace(
                /^(0[1-9]|1[0-2])$/g,
                "$1/" // 11 > 11/
              )
              .replace(
                /^([0-1])([3-9])$/g,
                "0$1/$2" // 13 > 01/3
              )
              .replace(
                /^(0?[1-9]|1[0-2])([0-9]{2})$/g,
                "$1/$2" // 141 > 01/41
              )
              .replace(
                /^([0]+)\/|[0]+$/g,
                "0" // 0/ > 0 and 00 > 0
              )
              .replace(
                /[^\d\/]|^[\/]*$/g,
                "" // To allow only digits and `/`
              )
              .replace(
                /\/\//g,
                "/" // Prevent entering more than 1 `/`
              );
          }
        </script>
        <!-- <script type="text/javascript">
          function handleFormSubmit(form) {
            checkPurchase(form);
          }

          function checkPurchase(form) {
            // alert("hii");
            var tokendata = "<%= tokens %>";
            var loginIds = "<%= userid %>";
            var subsids = "<%= tipsIds %>";

            $.ajax({
              type: 'POST',
              // url: 'https://apistest.tradetipsapp.com/api/serviceMentorSubscriptionPlanWeb/getAllTypeServicesForUser',
              url: 'https://apistest.tradetipsapp.com/api/subscriptionPlan/getAllNewSubscriptionPlan',
              data: {
                userId: loginIds
              },
              success: function (data) {
                // alert('hello')
                var dataks = JSON.stringify(data);
                var dataResultps = JSON.parse(dataks);
                // alert(dataResultps.serviceSubscriptions);
                // alert(dataResultps.serviceSubscriptions.length);
                if (dataResultps.serviceSubscriptions.length == 0) {
                  // alert("Purchase Allow !!");
                  form.submit();
                } else {
                  for (var i = 0; i < dataResultps.serviceSubscriptions.length; i++) {
                    if (dataResultps.serviceSubscriptions[i].serviceSubscriptionPlanId == subsids && dataResultps.serviceSubscriptions[i].stripeSubscriptionStatus == "active") {
                      // alert("You Already Purchased this Service !!");
                      $(".successmsg3").html(
                        "You Already Purchased this Service !!"
                      );
                      setTimeout(function () {
                        $(".successmsg3").empty();
                      }, 3000);
                    } else {
                      form.submit();
                      // alert("Purchase  Allow !!");
                    }
                  }

                }

              }

            });
          }
        </script> -->



        <script type="text/javascript">
          window.history.forward();
          function noBack() {
            window.history.forward();
          }


          var count = 0;

          function validate(coupon) {
            // count++;
            // if (count == 1) {



            var formdata = { couponId: coupon };

            $.ajax({
              type: "POST",
              url: "https://apistest.tradetipsapp.com/api/stripePayment/validateCoupon",
              data: formdata,
              success: function (data, textStatus, jqXHR) {
                // alert(data.percent_off);
                console.log(data);

                // console.log(data.percent_off);
                var finalpvals = data.percent_off;
                // alert(finalpvals);
                var pricess = $("#prices").val();
                //  var pricess = ActualP.val();

                // alert(pricess);
                var fdiscount = (pricess * finalpvals) / 100;
                //  alert(fdiscount);

                if (data.valid == true) {
                  count++;
                  if (count == 1) {
                    var Damount = pricess - fdiscount;
                    // alert(Damount)
                    document.getElementById("prices").value = fdiscount;

                    $(".successmsg3").html(
                      `<span style='padding-left:11px'>${"$" + pricess / 100}</span>` +
                      "<br>" +
                      "-" +
                      "    " +
                      `<span>${"$" + (fdiscount / 100).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]} </span>` +
                      "<span style='width:5px'>&nbsp; </span>" +
                      " Discount applied. Please continue your purchase."
                    );
                    setTimeout(function () {
                      $(".successmsg3").empty();
                    }, 1200000);

                    document.getElementById("priceServices").innerHTML = "$" + parseFloat(
                      Damount / 100
                    ).toFixed(2);
                  } else {
                    $(".successmsg3").html(
                      "Sorry, You can apply coupan code only once"
                    );
                    setTimeout(function () {
                      $(".successmsg3").empty();
                    }, 3000);
                  }
                }
              },
              error: function (errMsg) {
                // alert(JSON.stringify(errMsg));
                //  window.alert("Sorry, The Coupon Code you entered is invalid. Please check and try again!");
                $(".successmsg3").html(
                  "Sorry, The Coupon Code you entered is invalid. Please check and try again!"
                );
                setTimeout(function () {
                  $(".successmsg3").empty();
                }, 3000);
              },
            });
            // } else {
            //   $(".successmsg3").html(
            //     "Sorry, You can apply coupan code only once"
            //   );
            //   setTimeout(function () {
            //     $(".successmsg3").empty();
            //   }, 3000);
            // }
          }
        </script>

        <script type="text/javascript">
          var subsids = "<%= tipsIds %>";

          var formdata = { serviceSubscriptionPlanId: subsids };
          $.ajax({
            type: "POST",
            url: "https://apistest.tradetipsapp.com/api/serviceMentorSubscriptionPlanWeb/getServiceSubscriptionPlanById",
            data: formdata,
            success: function (data) {
              var datak = JSON.stringify(data);
              // alert(datak);
              var dataResultp = JSON.parse(datak);
              // alert(dataResultp.title);


              let str = dataResultp.stripeProductName;
              str = str.split("_")[0];
              document.getElementById("typeService").innerHTML = dataResultp.serviceTypeMaster.description;
              document.getElementById("nameService").innerHTML = dataResultp.title;
              document.getElementById("shortDescriptionService").innerHTML = dataResultp.descriptionOne;
              // document.getElementById("longDescriptionService").innerHTML = dataResultp.descriptionTwo;
              document.getElementById("mentorNameService").innerHTML = str;
              if (dataResultp.frequency == "0") {
                document.getElementById("frequncyService").innerHTML = "One Time";
              } else if (dataResultp.frequency == "1") {
                document.getElementById("frequncyService").innerHTML = "Daily";
              } else if (dataResultp.frequency == "7") {
                document.getElementById("frequncyService").innerHTML = "Weekly";
              } else if (dataResultp.frequency == "15") {
                document.getElementById("frequncyService").innerHTML = "Bi-weekly";
              } else if (dataResultp.frequency == "30") {
                document.getElementById("frequncyService").innerHTML = "Monthly";
              } else {
                document.getElementById("frequncyService").innerHTML = "Yearly";
              }
              document.getElementById("prices").value = dataResultp.price * 100;

              document.getElementById("priceService").innerHTML = "$" + parseFloat(dataResultp.price).toFixed(2);
              document.getElementById("priceServices").innerHTML = "$" + parseFloat(dataResultp.price).toFixed(2);
              if (dataResultp.imageDetails == null) {
                document.getElementById("serviceImage").src = dataResultp.thumbnailImageUrl;
              } else {
                document.getElementById("serviceImage").src = "https://apistest.tradetipsapp.com" + dataResultp.imageDetails;
              }



            },
          });
        </script>